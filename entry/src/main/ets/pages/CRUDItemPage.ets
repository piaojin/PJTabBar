import {PJTabComponent, PJTabComponentController, PJTabBarItemInterface, PJTabBarItem, PJTabBarOptionsInterface, PJTabBarOptions,
  PJReferenceTabBarItemInterface} from '@piaojin/pjtabbar'
import { PJIndicatorAnimationType } from '@piaojin/pjtabbar/src/main/ets/models/PJTabBarOptions'

/*
 * ç”¨äºŽåœ¨@Builderä¸­å¼•ç”¨ä¼ é€’: æŒ‰å¼•ç”¨ä¼ é€’å‚æ•°æ—¶ï¼Œä¼ é€’çš„å‚æ•°å¯ä¸ºçŠ¶æ€å˜é‡ï¼Œä¸”çŠ¶æ€å˜é‡çš„æ”¹å˜ä¼šå¼•èµ·@Builderæ–¹æ³•å†…çš„UIåˆ·æ–° (https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-builder-0000001524176981-V2)
 */
@Component
struct PJContentBuilderWrap {
  @State item: PJTabBarItemInterface = {id: '', index: 0, title: '' }
  currentItemIndex: number = 0
  @Link selectedItemIndex: number

  build() {
    Column() {
      Text(this.currentItemIndex + ' ' + this.item.title + ', ' + this.selectedItemIndex)
        .width('100%')
        .height('100%')
        .textAlign(TextAlign.Center)
        .backgroundColor(Color.Green)
    }
  }
}

@Entry
@Component
struct CRUDItemPage {
  private items: PJTabBarItemInterface[] = [new PJTabBarItem('çº¢çƒ§çŒªè¹„'), new PJTabBarItem('çŒ«å±±çŽ‹æ¦´èŽ²'), new PJTabBarItem('é¾™çœ¼'), new PJTabBarItem('è”æž'),
    new PJTabBarItem('ç‰›æ‚é¢'), new PJTabBarItem('çƒ¤ç¾Šè…¿'), new PJTabBarItem('ç‰›è‚‰ç«é”…'), new PJTabBarItem('è“é³é‡‘æžªé±¼åˆºèº«')]
  private options: PJTabBarOptionsInterface = new PJTabBarOptions()
  private controller: PJTabComponentController = new PJTabComponentController()
  @State private crudIndex: number = 0

  aboutToAppear() {
    this.options.indicatorWidth = 30
    this.options.indicatorHeight = 6
    this.options.indicatorColor = Color.Orange
    this.options.tabBarBackGround = Color.Pink
    this.options.selectedFontSize = 16
    this.options.selectedFontColor = Color.Orange
    this.options.tabBarContentMargin = { left: 10, right: 10 }
    this.options.indicatorAnimationType = PJIndicatorAnimationType.Linkage
  }

  @Builder titleBuilder() {
    Text('CRUD Item Page')
    .padding({ left: 20, top: 20 })
  }

  /*
   * 1. å½“contentBuilderä¸­çš„ç»„ä»¶ç”¨åˆ°PJTabBarItemçš„title/selectedItemIndexæ—¶ï¼Œå¹¶ä¸”å¸Œæœ›å½“è°ƒç”¨controllerçš„updateæ“ä½œåŽè¯¥ç»„ä»¶çš„title/selectedItemIndexæ—¶èƒ½è·Ÿç€æ›´æ–°ï¼Œé‚£ä¹ˆcontentBuilderçš„å†…å®¹éœ€è¦å°è£…åˆ°ä¸€ä¸ªå­ç»„ä»¶ä¸­ï¼Œä¾‹å¦‚PJContentBuilderWrapã€‚å¹¶ä¸”PJContentBuilderWrapéœ€è¦ä»¥
   * @State(ä¹Ÿå¯é‡‡ç”¨@ObjectLink) item: PJTabBarItemInterface = {id: '', index: 0, title: '' }
   * currentItemIndex: number = 0
   * @Link selectedItemIndex: number
   * çš„å½¢å¼ç»‘å®šæ•°æ®ã€‚è¿™ä¹ˆåšçš„åŽŸå› æ˜¯å½“æ•°æ®æºä»ŽPJTabComponentä¸­é€šè¿‡@Builderå‡½æ•°å¼•ç”¨ä¼ é€’åˆ°è°ƒç”¨è€…çš„contentBuilderæ—¶ï¼Œéœ€è¦é€šè¿‡@State/@ObjectLink/@Linkç­‰å…³é”®è¯æ‰èƒ½ç»‘å®šæ•°æ®æºï¼Œå¹¶ä¸”ç»„ä»¶çš„UIæ‰èƒ½è·Ÿç€æ•°æ®çš„å˜åŒ–è€Œå˜åŒ–ã€‚
   * è¯¦æƒ…å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£: https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-builder-0000001524176981-V2#section1522464044212 ä¸Ž https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-component-state-management-0000001524417205-V2
   *
   * 2. å½“contentä¸­çš„ç»„ä»¶ç”¨åˆ°PJTabBarItemçš„titleæ—¶ï¼Œå¹¶ä¸”ä¸éœ€è¦éšç€controllerçš„updateæ“ä½œåŽè¯¥ç»„ä»¶çš„titleèƒ½è·Ÿç€æ›´æ–°ï¼Œé‚£ä¹ˆå¯ä¸éœ€è¦å°†contentBuilderçš„å†…å®¹åŒ…è£…åœ¨ä¸€ä¸ªç»„ä»¶ä¸­ã€‚
   */
  @Builder contentBuilder($$: PJReferenceTabBarItemInterface, self: CRUDItemPage) {
    // å½“contentä¸­çš„ç»„ä»¶ç”¨åˆ°PJTabBarItemçš„titleæ—¶ï¼Œå¹¶ä¸”ä¸éœ€è¦éšç€controllerçš„updateæ“ä½œåŽè¯¥ç»„ä»¶çš„titleèƒ½è·Ÿç€æ›´æ–°ï¼Œé‚£ä¹ˆå¯ä»¥ä¸éœ€è¦å°†contentBuilderçš„å†…å®¹åŒ…è£…åœ¨ä¸€ä¸ªç»„ä»¶ä¸­ã€‚
    // Text($$.currentItemIndex + ' ' + $$.item.title + ', ' + $$.selectedItemIndex)
    //   .width('100%')
    //   .height('100%')
    //   .textAlign(TextAlign.Center)
    //   .backgroundColor(Color.Green)

    PJContentBuilderWrap({currentItemIndex: $$.currentItemIndex, selectedItemIndex: $$.selectedItemIndex, item: $$.item})
  }

  build() {
    Column() {
      Navigation() {
        Column() {
          PJTabComponent({
            index: 2,
            items: this.items,
            controller: this.controller,
            tabBarOptions: this.options,
            contentBuilder: ($$: PJReferenceTabBarItemInterface) => {
              this.contentBuilder($$, this)
            }
          })
            .width('100%')
            .height(150)
            .margin({ top: 30 })

          Row() {
            Button('Update')
              .onClick(() => {
                this.controller.update(2, new PJTabBarItem("æ›´æ–°é¾™çœ¼"))
              })

            Button('Insert')
              .onClick(() => {
                this.controller.insert(3, new PJTabBarItem("è èèœœðŸ¥­"))
                this.crudIndex += 1
              })

            Button('Delete')
              .onClick(() => {
                this.controller.delete(0)
              })
          }
          .margin({ top: 30 })
        }
      }
      .title(this.titleBuilder())
      .mode(NavigationMode.Stack)
      .titleMode(NavigationTitleMode.Mini)
    }
  }
}